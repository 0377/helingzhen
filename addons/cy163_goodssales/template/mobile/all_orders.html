<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1.0,maximum-scale=1.0,minimum-scale=1,user-scalable=no">
    <meta content="yes" name="apple-mobile-web-app-capable">
    <meta content="black" name="apple-mobile-web-app-status-bar-style">
    <meta content="telephone=no" name="format-detection">
    <meta content="email=no" name="format-detection">
    <title>我的订单</title>
    <link rel="stylesheet" href="{MD_ROOTN}/messi/css/reset.css"/>
    <link rel="stylesheet" href="{MD_ROOTN}/messi/iconfont/iconfont.css"/>
	<link rel="stylesheet" href="{MD_ROOTN}/messi/css/common.css"/>
	<link rel="stylesheet" href="{MD_ROOTN}/messi/css/myorder.css"/>
	<link rel="stylesheet" href="{MD_ROOTN}/jqueryweui/css/weui.min.css"/>
	<link rel="stylesheet" href="{MD_ROOTN}/jqueryweui/css/jquery-weui.min.css"/>
    <script>
        var deviceWidth = document.documentElement.clientWidth;
        document.documentElement.style.fontSize = deviceWidth / 7.5 + 'px';
    </script>
	<style>
	.filter .item{width:1.5rem;font-size:0.26rem;}
	</style>
</head>

<body style="background:#f5f5f5;">
<div id="header">
	<div class="goback iconfont" onclick="history.go(-1);">&#xe612;</div>
	<div class="title textellipsis1 text-c">我的订单</div>
	<div class="empty"></div>
</div>
<div class="filter">
	<div class="item text-c {if $_GPC['statuss'] == 0}now{/if}">待付款</div>
	<div class="item text-c {if $_GPC['statuss'] == 1}now{/if}">待发货/核销</div>
	<div class="item text-c {if $_GPC['statuss'] == 2}now{/if}">待收货</div>
	<div class="item text-c {if $_GPC['statuss'] == 4}now{/if}">待评价</div>
	<div class="item text-c {if $_GPC['statuss'] == 5}now{/if}">已完成</div>
</div>
<div class="orderlist {if $_GPC['statuss'] != 0}hide{/if}" data-index="0" data-count="2" data-status="0" data-allpage="{$allpage1}">
	<div class="append">
		{if $myorderlist1}
			{loop $myorderlist1 $row}
			<div class="item">
				<div class="top">
					<div class="storename textellipsis1">店铺：{php echo getmerchantname($v['merchant_id']);}</div>
					<div class="status text-r">等待付款</div>
					<div class="ordersn">订单编号：{$row['ordersn']}</div>
				</div>
				<a href="{php echo $this->createMobileUrl('detail',array('id'=>$row['goods']['id']))}">
				<div class="goods">
					<div class="img"><img src="{php echo tomedia($row['goods']['thumb']);}" /></div>
					<div class="goodsmsg">
						<div class="title textellipsis1">{$row['goods']['title']}</div>
						<div class="option">{$row['ordergoods']['optionname']}</div>
						<div class="pricenum">
							<div class="price">￥{$row['ordergoods']['price']}</div>
							<div class="num text-r">×{$row['ordergoods']['total']}</div>
						</div>
					</div>
				</div>
				</a>
				<div class="fee text-r">合计：<span class="c-orange">￥{$row['price']}</span></div>
				<div class="btns">
					<a href="{php echo $this->createMobileUrl('myorder',array('op'=>'detail','id'=>$row['id'],'merchant_id'=>$merchant_id))}" class="pay text-c">订单详情</a>
				</div>
			</div>
			{/loop}
		{else}
		<div class="noorder text-c">( ⊙ o ⊙ )啊哦，没有更多订单啦~</div>
		{/if}
	</div>
	<div class="load text-c hide">数据加载中</div>
</div>
<div class="orderlist {if $_GPC['statuss'] != 1}hide{/if}" data-index="1" data-count="2" data-status="1" data-allpage="{$allpage2}">
	<div class="append">
		{if $myorderlist2}
			{loop $myorderlist2 $row}
			<div class="item">
				<div class="top">
					<div class="storename textellipsis1">店铺：{php echo getmerchantname($v['merchant_id']);}</div>
					<div class="status text-r">{if $row['ishexiao'] == 1}待核销{else}待发货{/if}</div>
					<div class="ordersn">订单编号：{$row['ordersn']}</div>
				</div>
				<a href="{php echo $this->createMobileUrl('detail',array('id'=>$row['goods']['id']))}">
				<div class="goods">
					<div class="img"><img src="{php echo tomedia($row['goods']['thumb']);}" /></div>
					<div class="goodsmsg">
						<div class="title textellipsis1">{$row['goods']['title']}</div>
						<div class="option">{$row['ordergoods']['optionname']}</div>
						<div class="pricenum">
							<div class="price">￥{$row['ordergoods']['price']}</div>
							<div class="num text-r">×{$row['ordergoods']['total']}</div>
						</div>
					</div>
				</div>
				</a>
				<div class="fee text-r">合计：<span class="c-orange">￥{$row['price']}</span></div>
				<div class="btns">
					<a href="{php echo $this->createMobileUrl('myorder',array('op'=>'detail','id'=>$row['id'],'merchant_id'=>$merchant_id))}" class="pay text-c">订单详情</a>
				</div>
			</div>
			{/loop}
		{else}
		<div class="noorder text-c">( ⊙ o ⊙ )啊哦，没有更多订单啦~</div>
		{/if}
	</div>
	<div class="load text-c hide">数据加载中</div>
</div>
<div class="orderlist {if $_GPC['statuss'] != 2}hide{/if}" data-index="2" data-count="2" data-status="2" data-allpage="{$allpage3}">
	<div class="append">
		{if $myorderlist3}
			{loop $myorderlist3 $row}
			<div class="item">
				<div class="top">
					<div class="storename textellipsis1">店铺：{php echo getmerchantname($v['merchant_id']);}</div>
					<div class="status text-r">等待收货</div>
					<div class="ordersn">订单编号：{$row['ordersn']}</div>
				</div>
				<a href="{php echo $this->createMobileUrl('detail',array('id'=>$row['goods']['id']))}">
				<div class="goods">
					<div class="img"><img src="{php echo tomedia($row['goods']['thumb']);}" /></div>
					<div class="goodsmsg">
						<div class="title textellipsis1">{$row['goods']['title']}</div>
						<div class="option">{$row['ordergoods']['optionname']}</div>
						<div class="pricenum">
							<div class="price">￥{$row['ordergoods']['price']}</div>
							<div class="num text-r">×{$row['ordergoods']['total']}</div>
						</div>
					</div>
				</div>
				</a>
				<div class="fee text-r">合计：<span class="c-orange">￥{$row['price']}</span></div>
				<div class="btns">
					<a href="{php echo $this->createMobileUrl('myorder',array('op'=>'detail','id'=>$row['id'],'merchant_id'=>$merchant_id))}" class="pay text-c">订单详情</a>
				</div>
			</div>
			{/loop}
		{else}
		<div class="noorder text-c">( ⊙ o ⊙ )啊哦，没有更多订单啦~</div>
		{/if}
	</div>
	<div class="load text-c hide">数据加载中</div>
</div>
<div class="orderlist {if $_GPC['statuss'] != 4}hide{/if}" data-index="0" data-count="2" data-status="4" data-allpage="{$allpage4}">
	<div class="append">
		{if $myorderlist4}
			{loop $myorderlist4 $row}
			<div class="item">
				<div class="top">
					<div class="storename textellipsis1">店铺：{php echo getmerchantname($v['merchant_id']);}</div>
					<div class="status text-r">待评价</div>
					<div class="ordersn">订单编号：{$row['ordersn']}</div>
				</div>
				<a href="{php echo $this->createMobileUrl('detail',array('id'=>$row['goods']['id']))}">
				<div class="goods">
					<div class="img"><img src="{php echo tomedia($row['goods']['thumb']);}" /></div>
					<div class="goodsmsg">
						<div class="title textellipsis1">{$row['goods']['title']}</div>
						<div class="option">{$row['ordergoods']['optionname']}</div>
						<div class="pricenum">
							<div class="price">￥{$row['ordergoods']['price']}</div>
							<div class="num text-r">×{$row['ordergoods']['total']}</div>
						</div>
					</div>
				</div>
				</a>
				<div class="fee text-r">合计：<span class="c-orange">￥{$row['price']}</span></div>
				<div class="btns">
					<a href="{php echo $this->createMobileUrl('myorder',array('op'=>'detail','id'=>$row['id'],'merchant_id'=>$merchant_id))}" class="pay text-c">订单详情</a>
				</div>
			</div>
			{/loop}
		{else}
		<div class="noorder text-c">( ⊙ o ⊙ )啊哦，没有更多订单啦~</div>
		{/if}
	</div>
	<div class="load text-c hide">数据加载中</div>
</div>
<div class="orderlist {if $_GPC['statuss'] != 5}hide{/if}" data-index="0" data-count="2" data-status="5" data-allpage="{$allpage5}">
	<div class="append">
		{if $myorderlist5}
			{loop $myorderlist5 $row}
			<div class="item">
				<div class="top">
					<div class="storename textellipsis1">店铺：{php echo getmerchantname($v['merchant_id']);}</div>
					<div class="status text-r">待评价</div>
					<div class="ordersn">订单编号：{$row['ordersn']}</div>
				</div>
				<a href="{php echo $this->createMobileUrl('detail',array('id'=>$row['goods']['id']))}">
				<div class="goods">
					<div class="img"><img src="{php echo tomedia($row['goods']['thumb']);}" /></div>
					<div class="goodsmsg">
						<div class="title textellipsis1">{$row['goods']['title']}</div>
						<div class="option">{$row['ordergoods']['optionname']}</div>
						<div class="pricenum">
							<div class="price">￥{$row['ordergoods']['price']}</div>
							<div class="num text-r">×{$row['ordergoods']['total']}</div>
						</div>
					</div>
				</div>
				</a>
				<div class="fee text-r">合计：<span class="c-orange">￥{$row['price']}</span></div>
				<div class="btns">
					<a href="{php echo $this->createMobileUrl('myorder',array('op'=>'detail','id'=>$row['id'],'merchant_id'=>$merchant_id))}" class="pay text-c">订单详情</a>
				</div>
			</div>
			{/loop}
		{else}
		<div class="noorder text-c">( ⊙ o ⊙ )啊哦，没有更多订单啦~</div>
		{/if}
	</div>
	<div class="load text-c hide">数据加载中</div>
</div>
<script type="text/javascript" src="{MD_ROOTN}/messi/js/jquery-3.1.1.min.js"></script>
<script type="text/javascript" src="{MD_ROOTN}/jqueryweui/js/fastclick.js"></script>
<script type="text/javascript" src="{MD_ROOTN}/jqueryweui/js/jquery-weui.min.js"></script>
<script type="text/javascript">
$(function(){
	FastClick.attach(document.body);
	$('.filter .item').click(function(){
		$('.filter .item').removeClass('now');
		$(this).addClass('now');
		$('.orderlist').addClass('hide');
		$('.orderlist').eq($(this).index()).removeClass('hide');
	});
})


$(document.body).infinite().on("infinite", function() {
	var nowindex = $(".orderlist:not([class='hide']").attr('data-index');
	var count = parseInt($(".orderlist:not([class='hide']").attr('data-count'));
	var allpage = parseInt($(".orderlist:not([class='hide']").attr('data-allpage'));
	var status = parseInt($(".orderlist:not([class='hide']").attr('data-status'));
	var loading = false;
	var self = $(".orderlist").eq(nowindex);
	if(loading) return;
	loading = true;
	if(count < allpage){
		self.children('.load').removeClass('hide');
		setTimeout(function() {			
			$.ajax({
				url:"{php echo $this->createMobileUrl('myorder')}",
				data:{
					page:count,
					isajax:1,
					status:status,
				},
				dataType:'html',
				type:'post',        
				success:function(data){
					if(data != ''){
						self.children('.append').append(data);
						count++;
						self.attr('data-count',count);
					}
					loading = false;
				},
			});
		}, 500);   //模拟延迟
	}else{
		self.children('.load').text('全部数据已经加载完毕');
	}
});
</script>
</body>
</html>