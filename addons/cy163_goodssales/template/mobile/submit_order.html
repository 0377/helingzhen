<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no" name="viewport">
    <meta content="yes" name="apple-mobile-web-app-capable">
    <meta content="black" name="apple-mobile-web-app-status-bar-style">
    <meta content="telephone=no" name="format-detection">
    <meta content="email=no" name="format-detection">
    <link rel="stylesheet" href="../addons/cy163_goodssales/static/css/reset.css"/>
    <link rel="stylesheet" href="../addons/cy163_goodssales/static/iconfont/iconfont.css"/>
    <link rel="stylesheet" href="../addons/cy163_goodssales/static/lib/swiper-3.3.1.min.css"/>
    <script>
        var deviceWidth = document.documentElement.clientWidth;
		var deviceHeight = document.documentElement.clientHeight;
        document.documentElement.style.fontSize = deviceWidth / 7.5 + 'px';
    </script>
    <title>结算</title>
	<style>		 
		 .submit_order_product{display:-webkit-flex; display:flex; justify-content:space-between; padding:0.24rem; background:#f5f5f5; position:relative; margin-bottom:0.05rem}
		 .submit_order_product .submit_order_product_r{width:4.75rem; font-size:0.28rem}
		 .submit_order_product img{ width:2rem; height:2rem}
		 .submit_order_product_name{display:-webkit-flex; display:flex; justify-content:space-between; line-height:0.34rem;}
		 .submit_order_product_nametext{width:3.2rem}
	
		 .submit_order_product_name p{color:#999; font-size:0.3rem}
		 .submit_order_product_size{line-height:0.34rem; color:#999; font-size:0.24rem; margin:0.18rem 0;}
		 .submit_order_product_price{display:-webkit-flex; display:flex; align-items:center; justify-content:space-between; color:#cd2b2b; font-size:0.3rem;}
		 .submit_order_product_price em{font-size:0.22rem}
		 .submit_order_product_price p{color:#333;}
		 .submit_order_product_backbtn{position:absolute; background:#fff; color:#c31c1c; border:1px solid #c31c1c; border-radius:0.1rem; padding:0.12rem 0.28rem; right:0.24rem; bottom:0.24rem; display:block; font-size:0.24rem;}
		 .submit_order_product_aixingbi{display:-webkit-flex; display:flex; align-items:center;  }
		 .submit_order_product_aixingbi div{width:0.24rem; height:0.24rem; border-radius:0.05rem; font-size:0.16rem; margin-right:0.1rem; background:#c31c1c; text-align:center; line-height:0.24rem; color:#fff;}
		 
		 
		 #submit_order_store_expenses,#submit_order_coupun,#shr{font-size:0.28rem; line-height:0.85rem; color:#333; border-bottom:0.18rem solid #f4f4f4;}

		 
		 .submit_order_store_div,.submit_order_overfolow_coupun{display:-webkit-flex; display:flex; line-height:0.85rem; justify-content:space-between;  align-items:center; padding:0 0.24rem; border-bottom:1px solid #e5e5e5}
		 .submit_order_store_div input{border:0rem; width:100%}
		 .submit_order_store_div select{border:1px #ccc solid;width:auto;color:#333;margin-right:0.1rem;padding:0.1rem;}
		 .submit_order_store_div em{font-size:0.2rem}
		 .submit_order_store_allprice{color:#c31c1c; font-size:0.3rem}
		 .submit_order_store_allprice em{font-size:0.22rem}
		 .submit_order_textalign_r{border:0rem;}
		 .submit_order_textalign_r div{text-align:right; width:100%}
		 
		 #submit_order_coupun{margin-bottom:1.1rem}
		 #submit_order_store_typetime{padding:0.24rem; line-height:0.44rem; color:#999; font-size:0.28rem; margin-bottom:1.1rem}
		 .submit_order_openbtn{display:-webkit-flex; display:flex; align-items:center;}
		 
		 #submit_order_store_bottom_btn{border-top:1px solid #e5e5e5; height:1rem; display:-webkit-flex; display:flex; justify-content:flex-end; font-size:0.24rem; position:fixed; bottom:0rem; width:7.5rem; background:#fff;}
		 #submit_order_store_bottom_btn div{display:-webkit-flex; display:flex; justify-content:center; align-items:center; font-size:0.3rem}
		 #submit_order_store_bottom_btn .submit_order_red_btn{color:#fff; width:2.2rem; height:1rem; background:#cd2b2b; font-size:0.32rem; margin-left:0.2rem}
		 
		 #submit_order_overfolow_balckbg{position:fixed; top:0; left:0; right:0; bottom:0; background:#000; opacity:0.3; z-index:999}
		 
		 #submit_order_overfolow_coupun,#submit_order_overfolow_hippingMethod{width:7.5rem; height:5.18rem; position:fixed; bottom:-5.5rem; background:#fff; font-size:0.28rem; z-index:99999}
		 .submit_order_overfolow_coupun_title{font-size:0.3rem; font-weight:bolder}
		 .radio{width:0.34rem; height:0.34rem; border-radius:0.34rem; border:1px solid #999; background:#fff; line-height:0.36rem; text-align:center; font-size:0.32rem; color:#fff;}
		 .red_seleced{background:#cd2b2b; border:1px solid #cd2b2b;}
		 
		 
		 #submit_order_overfolow_paytype, #submit_order_overfolow_paysuccess{width:100%; height:100%; background:#fff; position:fixed; top:0rem; left:0rem; z-index:999999}
		 .submit_order_overfolow_paytype_div,.submit_order_overfolow_paytype_title,.submit_order_overfolow_paytype_allprice{color:#666; font-size:0.3rem; line-height:1.38rem; height:1.38rem; border-bottom:1px solid #dcdcdc; padding:0 0.24rem}
		 .submit_order_overfolow_paytype_title{font-weight:bolder;}
		 .submit_order_overfolow_paytype_div,.submit_order_overfolow_paytype_allprice{display:-webkit-flex; display:flex; justify-content:space-between; align-items:center;}
		
		 .wechat_icon{color:#50cb00; font-size:0.5rem; margin-right:0.3rem;}
		 .zfb_icon{color:#4bacf1; font-size:0.4rem; margin-right:0.3rem;}
		 .submit_order_overfolow_paytype_allprice{border-bottom:0rem; font-weight:bolder;}
		 .submit_order_overfolow_paytype_bottomBtn{display:-webkit-flex; display:flex; justify-content:space-between; align-items:center; color:#fff; font-size:0.32rem; font-weight:bolder; position:absolute; bottom:0rem; width:7.5rem}
		 .submit_order_overfolow_paytype_bottomBtn div{width:50%; background:#e69422; height:0.95rem; line-height:0.95rem; text-align:center}
		 .submit_order_overfolow_paytype_paybtn{background:#cd2b2b !important;}
		 
		 .submit_order_overfolow_paysuccess{display:-webkit-flex; display:flex; justify-content:center; align-items:center; font-size:0.3rem; color:#333; height:100%;}
		 .submit_order_overfolow_paysuccess_btn{position:absolute; bottom:0rem; left:0rem; width:100%;height:0.95rem; line-height:0.95rem; color:#fff; text-align:center; font-size:0.32rem; font-weight:bolder; background:#cd2b2b;}
		 .submit_order_overfolow_paysuccess .iconfont{font-size:1rem; color:#cd2b2b; margin-left:0.15rem}
		 
		 #submit_order_overfolow_dingjing{position:fixed; left:50%; top:50%; width:6.26rem; height:4.19rem; margin-left:-3.13rem; margin-top:-2.09rem; background:#fff; border-radius:0.1rem; z-index:99999}
		 .submit_order_overfolow_dingjing_title{font-size:0.36rem; color:#000; line-height:1.2rem; text-align:center}
		 .submit_order_overfolow_dingjing_text{font-size:0.24rem; color:#666; margin:0 0.45rem; border-top:1px solid #cbcbcb; line-height:0.35rem; padding:0.25rem 0;}
		 .submit_order_overfolow_dingjing_btn{width:2.94rem; height:0.72rem; line-height:0.72rem; font-size:0.36rem; text-align:center; margin:0.3rem auto 0; border-radius:0.1rem; background:#cd2b2b; color:#fff;}
		  
		 .submit_order_overfolow{display:none}
		 
		.tgl{display:none}
		.tgl,.tgl *,.tgl :after,.tgl :before,.tgl+.tgl-btn,.tgl:after,.tgl:before{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}
		.tgl ::-moz-selection,.tgl :after::-moz-selection,.tgl :before::-moz-selection,.tgl+.tgl-btn::-moz-selection,.tgl::-moz-selection,.tgl:after::-moz-selection,.tgl:before::-moz-selection{background:0 0}
		.tgl ::selection,.tgl :after::selection,.tgl :before::selection,.tgl+.tgl-btn::selection,.tgl::selection,.tgl:after::selection,.tgl:before::selection{background:0 0}
		.tgl+.tgl-btn{outline:0;display:block;width:4em;height:2em;position:relative;cursor:pointer}
		.tgl+.tgl-btn:after,.tgl+.tgl-btn:before{position:relative;display:block;content:"";width:50%;height:100%}
		.tgl+.tgl-btn:after{left:0}
		.tgl+.tgl-btn:before{display:none}
		.tgl:checked+.tgl-btn:after{left:50%}
		
		
		.tgl-light+.tgl-btn{background:#f0f0f0;border-radius:2em;padding:2px;-webkit-transition:all .4s ease;transition:all .4s ease}
		.tgl-light+.tgl-btn:after{border-radius:50%;background:#fff;-webkit-transition:all .2s ease;transition:all .2s ease}
		.tgl-light:checked+.tgl-btn{background:#6ecf4d}
		
		
		.tgl-ios+.tgl-btn{background:#fbfbfb;border-radius:2em;padding:2px;-webkit-transition:all .4s ease;transition:all .4s ease;border:1px solid #e8eae9}
		.tgl-ios+.tgl-btn:after{border-radius:2em;background:#fbfbfb;-webkit-transition:left .3s cubic-bezier(.175,.885,.32,1.275),padding .3s ease,margin .3s ease;transition:left .3s cubic-bezier(.175,.885,.32,1.275),padding .3s ease,margin .3s ease;-webkit-box-shadow:0 0 0 1px rgba(0,0,0,.1),0 4px 0 rgba(0,0,0,.08);box-shadow:0 0 0 1px rgba(0,0,0,.1),0 4px 0 rgba(0,0,0,.08)}
		.tgl-ios+.tgl-btn:active{-webkit-box-shadow:inset 0 0 0 2em #e8eae9;box-shadow:inset 0 0 0 2em #e8eae9}
		.tgl-ios+.tgl-btn:active:after{padding-right:.8em}
		.tgl-ios:checked+.tgl-btn{background:#86d993}
		.tgl-ios:checked+.tgl-btn:active{-webkit-box-shadow:none;box-shadow:none}
		.tgl-ios:checked+.tgl-btn:active:after{margin-left:-.8em}
		
		
		.tgl-skewed+.tgl-btn{overflow:hidden;-webkit-transform:skew(-10deg);-ms-transform:skew(-10deg);transform:skew(-10deg);-webkit-backface-visibility:hidden;-ms-backface-visibility:hidden;backface-visibility:hidden;-webkit-transition:all .2s ease;transition:all .2s ease;font-family:sans-serif;background:#888}
		.tgl-skewed+.tgl-btn:after,.tgl-skewed+.tgl-btn:before{-webkit-transform:skew(10deg);-ms-transform:skew(10deg);transform:skew(10deg);display:inline-block;-webkit-transition:all .2s ease;transition:all .2s ease;width:100%;text-align:center;position:absolute;line-height:2em;font-weight:700;color:#fff;text-shadow:0 1px 0 rgba(0,0,0,.4)}
		.tgl-skewed+.tgl-btn:after{left:100%;content:attr(data-tg-on)}
		.tgl-skewed+.tgl-btn:before{left:0;content:attr(data-tg-off)}
		.tgl-skewed+.tgl-btn:active{background:#888}
		.tgl-skewed+.tgl-btn:active:before{left:-10%}
		.tgl-skewed:checked+.tgl-btn{background:#86d993}
		.tgl-skewed:checked+.tgl-btn:before{left:-100%}
		.tgl-skewed:checked+.tgl-btn:after{left:0}
		.tgl-skewed:checked+.tgl-btn:active:after{left:10%}
		
		
		.tgl-flat+.tgl-btn{padding:2px;-webkit-transition:all .2s ease;transition:all .2s ease;background:#fff;border:4px solid #f2f2f2;border-radius:2em}
		.tgl-flat+.tgl-btn:after{-webkit-transition:all .2s ease;transition:all .2s ease;background:#f2f2f2;content:"";border-radius:1em}
		.tgl-flat:checked+.tgl-btn{border:4px solid #7FC6A6}
		.tgl-flat:checked+.tgl-btn:after{left:50%;background:#7FC6A6}
		
		
		.tgl-flip+.tgl-btn{padding:2px;-webkit-transition:all .2s ease;transition:all .2s ease;font-family:sans-serif;-webkit-perspective:100px;-ms-perspective:100px;perspective:100px}
		.tgl-flip+.tgl-btn:after,.tgl-flip+.tgl-btn:before{display:inline-block;-webkit-transition:all .4s ease;transition:all .4s ease;width:100%;text-align:center;position:absolute;line-height:2em;font-weight:700;color:#fff;position:absolute;top:0;left:0;-webkit-backface-visibility:hidden;-ms-backface-visibility:hidden;backface-visibility:hidden;border-radius:4px}
		.tgl-flip+.tgl-btn:after{content:attr(data-tg-on);background:#02C66F;-webkit-transform:rotateY(-180deg);-ms-transform:rotateY(-180deg);transform:rotateY(-180deg)}
		.tgl-flip+.tgl-btn:before{background:#FF3A19;content:attr(data-tg-off)}
		.tgl-flip+.tgl-btn:active:before{-webkit-transform:rotateY(-20deg);-ms-transform:rotateY(-20deg);transform:rotateY(-20deg)}
		.tgl-flip:checked+.tgl-btn:before{-webkit-transform:rotateY(180deg);-ms-transform:rotateY(180deg);transform:rotateY(180deg)}
		.tgl-flip:checked+.tgl-btn:after{-webkit-transform:rotateY(0);-ms-transform:rotateY(0);transform:rotateY(0);left:0;background:#7FC6A6}
		.tgl-flip:checked+.tgl-btn:active:after{-webkit-transform:rotateY(20deg);-ms-transform:rotateY(20deg);transform:rotateY(20deg)}
		 
	</style>
</head>
<body>

{if $goods['isneedshouhuo'] == 1}
<div id="shr">
	<div class="submit_order_store_div"><div>收货人：</div><div style="width:75%;"><input type="text" id="realname" placeholder="收货人真实姓名"></div></div>
	<div class="submit_order_store_div"><div>手机号码：</div><div style="width:75%;"><input type="tel" id="telphone" placeholder="收货人手机号码"></div></div>
	<div class="submit_order_store_div"><div>选择地区：</div><div id="live" style="width:75%;"><select id="province" class="prov"><option value="">加载中</option></select><select id="city" class="city" style="display:none;"></select><select id="district" class="dist" style="display:none;"></select></div></div>
	<div class="submit_order_store_div"><div>详细地址：</div><div style="width:75%;"><input type="text" id="address" placeholder="详细地址"></div></div>
</div>
{/if}

<div class="submit_order_product">
   <img src="{php echo tomedia($goods['thumb'])}" />
   <div class="submit_order_product_r">
	    <div class="submit_order_product_name">
			<div class="submit_order_product_nametext">{$goods['title']}</div>  
	    </div>

	    <div class="submit_order_product_size">
		   <p>{$specs['title']}{if $specs['title']}{/if}</p>
   	    </div>	
     
	    <div class="submit_order_product_price">
			<div><em>¥</em> {$goodsprice}</div>
			<p>×{$buynum}</p>
	     </div> 
   </div>   
</div>

<div class="submit_order_store_div" onclick="show_order_list_overfolow('submit_order_overfolow_hippingMethod')"><div style="font-size:0.28rem;">支付方式：</div><div style="font-size:0.28rem;" id="payname">微信支付<span class="iconfont">&#xe61a;</span></div></div>

<div id="submit_order_store_expenses">
	<div class="submit_order_store_div"><div>买家留言：</div><div><input type="text" id="remark" placeholder="对本次交易的说明（选填）"></div></div>
	<div class="submit_order_store_div"><div>运费</div><div><em>¥</em> {$yunfei}</div></div>
	<div class="submit_order_store_div submit_order_textalign_r"><div>共{$buynum}件商品      合计：<span class="submit_order_store_allprice"><em>¥</em> {$allprice}</span></div></div>
</div>


<div id="submit_order_store_bottom_btn">
	<div>共<span class="submit_order_store_allprice">{$buynum}</span>件商品      合计：<span class="submit_order_store_allprice"><em>¥</em> {$allallprice}</span></div>
	<div class="submit_order_red_btn" onClick="suborder();">提交订单</div>
</div>

<div id="submit_order_overfolow_balckbg" class="submit_order_overfolow" onClick="hide_overfolow()">
    
</div> 

<div id="submit_order_overfolow_hippingMethod" class="submit_order_overfolow">
    <div class="submit_order_overfolow_coupun submit_order_overfolow_coupun_title"><div>支付方式：</div></div>
	<div class="submit_order_overfolow_coupun"><div>微信支付</div><div class="radio iconfont red_seleced" onclick="changepaytype(1,'微信支付');">&#xe66d;</div></div>
	{if $goods['cannotpay'] == 1}
	<div class="submit_order_overfolow_coupun"><div>货到付款</div><div class="radio iconfont"  onclick="changepaytype(2,'货到付款');">&#xe66d;</div></div>
	{/if}
	<div style="position:absolute; bottom:0rem; left:0rem; background:#cd2b2b; text-align:center; line-height:0.85rem; height:0.85rem; width:7.5rem; color:#FFFFFF; font-weight:bolder" onClick="hide_overfolow()">确认</div>
</div>
<input type="hidden" id="paytype" value="1" />

<script src="../addons/cy163_goodssales/static/lib/jquery-3.1.1.min.js"></script>
{if $goods['isneedshouhuo'] == 1}
<script src="../addons/cy163_goodssales/static/js/jquery.cityselect.js"></script>
{/if}
<script>
	{if $goods['isneedshouhuo'] == 1}
	$("#live").citySelect({
		nodata:"none",
		required:false
	});
	{/if}
	$('#submit_order_overfolow_coupun .radio').click(
	    function(){
		    $('#submit_order_overfolow_coupun .radio').removeClass('red_seleced');
		    $(this).addClass('red_seleced');
		}
	)
	
	$('.submit_order_overfolow_paytype_div .radio').click(
	    function(){
		    $('.submit_order_overfolow_paytype_div .radio').removeClass('red_seleced');
		    $(this).addClass('red_seleced');
		}
	)
	
	function changepaytype(type,name){
		$('#paytype').val(type);
		$('#payname').html(name+'<span class="iconfont">&#xe61a;</span>');
	}
	var kaiguan = true;
	function suborder(){
		if(kaiguan){
			kaiguan = false;
			$('.submit_order_red_btn').html('提交中...');
			$.ajax({   
				 url:"{php echo $this->createMobileUrl('dobuy')}",   
				 type:'post', 
				 data:{
					goodsid:{$goodsid},
					buynum:{$buynum},
					optionval:'{$optionval}',
					realname:$('#realname').val(),
					telphone:$('#telphone').val(),
					province:$('#province').val(),
					city:$('#city').val(),
					district:$('#district').val(),
					address:$('#address').val(),
					remark:$('#remark').val(),
					paytype:$('#paytype').val(),
					shareopenid:'{$shareopenid}',
				 },
				 dataType:'json',
				 success:function(data){   
					if (data.error == 1) {
						alert(data.message);
					} else {
						if(data.paytype == 2){
							var buyurl = "{php echo $this->createMobileUrl('myorder')}";
						}else{
							var buyurl = "{php echo $this->createMobileUrl('pay')}"+"&ordersn="+data.ordersn;
						}
						window.location.href = buyurl;
					} 
					kaiguan = true;
				 }
			});
		}
	}
	
	$('#submit_order_overfolow_hippingMethod .radio').click(
	    function(){
		    $('#submit_order_overfolow_hippingMethod .radio').removeClass('red_seleced');
		    $(this).addClass('red_seleced');
		}
	)
	
	function hide_overfolow(){
	   $('.submit_order_overfolow').hide();
	   $('#submit_order_overfolow_coupun').css('bottom','-5.5rem');
	   $('#submit_order_overfolow_hippingMethod').css('bottom','-5.5rem');
	}
	
	//显示浮层
	function show_order_list_overfolow(name){
	   hide_overfolow();
	   $('#submit_order_overfolow_balckbg').fadeIn();
	   $('#'+name).show();
	   $('#'+name).animate({'bottom':0},200);
	}
	
	//购买数量
	(function() {
		window.inputNumber = function(el) {
		var min = el.attr('min') || false;
		var max = el.attr('max') || false;
	
		var els = {};
	
		els.dec = el.prev();
		els.inc = el.next();
	
		el.each(function() {
		  init($(this));
		});
	
		function init(el) {
	
		  els.dec.on('click', decrement);
		  els.inc.on('click', increment);
	
		  function decrement() {
			var value = el[0].value;
			value--;
			if(!min || value >= min) {
			  el[0].value = value;
			}
		  }
	
		  function increment() {
			var value = el[0].value;
			value++;
			if(!max || value <= max) {
			  el[0].value = value++;
			}
		  }
		}
	  }
	})();
	inputNumber($('.input-number'));
</script>
</body>

</html>