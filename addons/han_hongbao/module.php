<?php 

defined('IN_IA') or exit('Access Denied'); define('MB_ROOT', IA_ROOT . '/addons/han_hongbao'); class Han_hongbaoModule extends WeModule { public function settingsDisplay($settings) { global $_W, $_GPC; if(checksubmit()) { load()->func('file'); mkdirs(MB_ROOT . '/cert'); $r = true; if(!empty($_GPC['cert'])) { $ret = file_put_contents(MB_ROOT . '/cert/apiclient_cert'. $_W['uniacid'].'.pem' , trim($_GPC['cert'])); $r = $r && $ret; } if(!empty($_GPC['key'])) { $ret = file_put_contents(MB_ROOT . '/cert/apiclient_key'. $_W['uniacid'].'.pem', trim($_GPC['key'])); $r = $r && $ret; } if(!empty($_GPC['ca'])) { $ret = file_put_contents(MB_ROOT . '/cert/rootca'. $_W['uniacid'].'.pem', trim($_GPC['ca'])); $r = $r && $ret; } if(!$r) { message('证书保存失败, 请保证 /addons/enjoy_guess/cert/ 目录可写'); } $input = array_elements(array('appid', 'secret', 'mchid', 'password', 'ip','mid','wishing','remark','nick_name','send_name'), $_GPC); $input['appid'] = trim($input['appid']); $input['secret'] = trim($input['secret']); $input['mchid'] = trim($input['mchid']); $input['mid'] = trim($input['mid']); $input['password'] = trim($input['password']); $input['wishing'] = trim($input['wishing']); $input['remark'] = trim($input['remark']); $input['nick_name'] = trim($input['nick_name']); $input['send_name'] = trim($input['send_name']); $input['ip'] = trim($input['ip']); $setting = $this->module['config']; $setting['api'] = $input; if($this->saveSettings($setting)) { message('保存参数成功', 'refresh'); } } $config = $this->module['config']['api']; if(empty($config['ip'])) { $config['ip'] = $_SERVER['SERVER_ADDR']; } include $this->template('setting'); } }

?>