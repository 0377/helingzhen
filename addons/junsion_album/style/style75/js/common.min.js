function getUrlParams(){var e=location.search,i=new Object;if(-1!=e.indexOf("?"))for(var n=e.substr(1),o=n.split("&"),a=0;a<o.length;a++)i[o[a].split("=")[0]]=o[a].split("=")[1];return i}function addCookie(e,i,n){console.log("[Cookie]Add:"+e+","+i+","+n);var o=e+"="+escape(i);if(n>0){var a=new Date;a.setTime(a.getTime()+3600*n*1e3),o=o+"; expires="+a.toGMTString()}document.cookie=o}function getCookie(e){for(var i=document.cookie,n=i.split("; "),o=0;o<n.length;o++){var a=n[o].split("=");if(a[0]==e)return unescape(a[1])}return""}function $node(e){return document.getElementById(e)}function $listen(e,i,n){e.addEventListener?e.addEventListener(i,n,!1):e.attachEvent&&e.attachEvent(i,n)}function $unlisten(e,i,n){e.removeEventListener?e.removeEventListener(i,n):e.detachEvent&&e.detachEvent(i,n)}function calcImgClip(e,i,n,o){var a,t,s,l;return n/o>e/i?(t=i,a=Math.floor(i*(n/o))):(a=e,t=Math.floor(e*(o/n))),s=(a-e)/2,l=(t-i)/2,{objWidth:a,objHeight:t,clipLeft:s,clipTop:l}}function checkOpenId(){var e="uid";if(""!=getCookie(e))console.log("Openid use cookie");else{var i=getUrlParams(),n=i.openid;if(void 0==n){console.log("openid is not exist, redirect");var o=location.href;o=o.replace(/\./g,"_d_"),o=o.replace(/\:/g,"_mh_"),o=o.replace(/\//g,"_xg_"),o=o.replace(/\?/g,"_wh_"),o=o.replace(/\&/g,"_y_"),o=o.replace(/\=/g,"_dh_");var a="wx1f77672efbc50503",t="http://wxauth.kagirl.net/wx/callback_ttxuanpai.php";t=t+"?back_url="+o,location.href="https://open.weixin.qq.com/connect/oauth2/authorize?appid="+a+"&redirect_uri="+encodeURIComponent(t)+"&response_type=code&scope=snsapi_base&state=STATE#wechat_redirect"}else console.log("Get redirect openid:"+n),addCookie(e,n,72)}}function getUID(){var e=getCookie("uid");if(""==e){var i=getUserInfo();null!=i&&(e=i.openid)}return e}function getUserInfo(){try{return JSON.parse(getCookie("ttxp_userinfo"))}catch(e){return console.log("exception when getUserInfo,msg:"+e.message+", desc:"+e.description),null}}function checkWxUserInfo(){var e="ttxp_userinfo";if(""!=getCookie(e))console.log("User info use cookie");else{var i=getUrlParams(),n=i.openid;if(void 0==n){console.log("openid is not exist, redirect");var o=location.href;o=o.replace(/\./g,"_d_"),o=o.replace(/\:/g,"_mh_"),o=o.replace(/\//g,"_xg_"),o=o.replace(/\?/g,"_wh_"),o=o.replace(/\&/g,"_y_"),o=o.replace(/\=/g,"_dh_");var a="wx1f77672efbc50503",t="http://wxauth.kagirl.net/wx/userinfo_ttxp.php";t=t+"?back_url="+o,location.href="https://open.weixin.qq.com/connect/oauth2/authorize?appid="+a+"&redirect_uri="+encodeURIComponent(t)+"&response_type=code&scope=snsapi_userinfo&state=STATE#wechat_redirect"}else{console.log("Get redirect info:"+n),addCookie("uid",n,1);var s={openid:n,headimgurl:decodeURIComponent(i.headimgurl),nickname:decodeURIComponent(i.nickname),sex:i.sex};addCookie(e,JSON.stringify(s),72)}}}function hasClass(e,i){return e.className.match(new RegExp("(\\s|^)"+i+"(\\s|$)"))}function addClass(e,i){hasClass(e,i)||(e.className+=" "+i)}function removeClass(e,i){if(hasClass(e,i)){var n=new RegExp("(\\s|^)"+i+"(\\s|$)");e.className=e.className.replace(n,"")}}function QOS_Report(e,i){console.log("reportData, type:"+e+", value:"+i),$.ajax({type:"POST",url:"http://qos.ttxuanpai.com/data/report",data:JSON.stringify({type:e,data:{value:i}}),dataType:"json"})}function QOS_Error(e){QOS_Report("ERROR",e)}function $transform(e,i){e.style.transform=e.style["-webkit-transform"]=e.style["-ms-transform"]=i}function wxImgDownloader(){var e=[],i=0,n=!1;this.pushTask=function(a,t){var s={serverId:a,callback:t,id:i++};console.log("add download task. #"+s.id),e.push(s),0==n&&o()};var o=function(){e.length>0&&(n=!0,t(e.pop()))},a=function(e,i,a){console.log("end download task #"+i.id+", ret:"+e),n=!1,i.callback(e,i.serverId,a),o()},t=function(e){console.log("begin download task #"+e.id+", id:"+e.serverId),wx.downloadImage({serverId:e.serverId,isShowProgressTips:0,success:function(i){a(!0,e,i.localId)},fail:function(i){console.log("download task fail, #"+e.id+",res:"+JSON.stringify(i)),a(!1,e,"")},complete:function(i){console.log("download task complete, #"+e.id+",res:"+JSON.stringify(i))},cancel:function(i){console.log("download task cancel, #"+e.id+",res:"+JSON.stringify(i))},trigger:function(i){console.log("download task trigger, #"+e.id+",res:"+JSON.stringify(i))}}),console.log("downloading task #"+e.id)}}function wxImgUploader(){var e=[],i=0,n=!1;this.pushTask=function(a,t){var s={localId:a,callback:t,id:i++};console.log("add upload task #"+s.id),e.push(s),0==n&&o()};var o=function(){e.length>0&&(n=!0,window.setTimeout(function(){t(e.pop())},100))},a=function(e,i,a){console.log("end upload task #"+i.id+", ret:"+e+", serverId:"+a),n=!1,i.callback(e,i.localId,a),o()},t=function(e){console.log("begin upload task #"+e.id+", id:"+e.localId),wx.uploadImage({localId:e.localId,isShowProgressTips:0,success:function(i){a(!0,e,i.serverId)},fail:function(){a(!1,e,"")},complete:function(){console.log("[wx]upload image complete #",e.id)}})}}TTXP_Animation_Mgr=new function(){function e(e){var a=$(this).data(i),t=$(this).data(n),s=$(this).data(o);t&&t(this,e.animationName),e.animationName==a&&s&&s(this)}var i="animation-mgr-last-animation-name",n="animation-mgr-callback-progress",o="animation-mgr-callback-end";this.animate=function(a,t){for(var s="",l="",c="",r="",d=0,u="",g=0;g<t.animates.length;++g){var p=t.animates[g];0!=g&&(s+=",",l+=",",c+=",",r+=","),s+=p.name,l+=p.duration+"s",c+=d+p.delay+"s",d+=p.delay+p.duration,r+=p.timings||"ease",u=p.name}LOG.trace("animate params:\n names:"+s+"\n durations:"+l+"\n delays:"+c),$(a).data(i,u).data(n,t.progress||null).data(o,t.end||null),$(a).css("animation-name",s).css("-webkit-animation-name",s).css("animation-duration",l).css("-webkit-animation-duration",l).css("animation-delay",c).css("-webkit-animation-delay",c).css("animation-timing-function",r).css("-webkit-animation-timing-function",r),$listen(a,"webkitAnimationEnd",e),$listen(a,"animationEnd",e)}};var TTXP_DA=new function(){this.click=function(e){try{MtaH5.clickStat(e)}catch(i){}}},TTXP_UI=new function(){this.MessageBox=new function(){var e="ttxp_msg_box_ok_cancel";this.show=function(i){var n='<div class="weui_mask"></div>                <div class="weui_dialog">                    <div class="weui_dialog_hd"><strong class="weui_dialog_title">弹窗标题</strong></div>                    <div class="weui_dialog_bd ttxp_msg_box_content">自定义弹窗内容<br>...</div>                    <div class="weui_dialog_ft">                        <a href="javascript:;" class="weui_btn_dialog default ttxp_msg_box_btn_cancel">取消</a>                        <a href="javascript:;" class="weui_btn_dialog primary ttxp_msg_box_btn_ok">确定</a>                    </div>                </div>',o=$("#"+e);if(!o.length){var a=document.createElement("div");$(a).addClass("weui_dialog_confirm").css("display","none").css("z-index",99999).css("position","absolute").attr("id",e).html(n),$("body").append(a),o=$("#"+e)}i&&null!=i.title&&void 0!=i.title&&o.find(".weui_dialog_title").text(i.title),i&&i.message&&o.find(".ttxp_msg_box_content").html(i.message),o.find(".ttxp_msg_box_btn_ok").on("click",function(){i&&i.ok&&i.ok(),o.hide(),o.remove()}),o.find(".ttxp_msg_box_btn_cancel").on("click",function(){i&&i.cancel&&i.cancel(),o.hide(),o.remove()}),o.show()},this.hide=function(){var i=$("#"+e);i.length&&(i.hide(),i.remove())}},this.LoadingToast=new function(){var e="ttxp_loading_toast";this.show=function(i){var n='                <div class="weui_mask"></div>                <div class="weui_toast">                    <div class="weui_loading">                        <div class="weui_loading_leaf weui_loading_leaf_0"></div>                        <div class="weui_loading_leaf weui_loading_leaf_1"></div>                        <div class="weui_loading_leaf weui_loading_leaf_2"></div>                        <div class="weui_loading_leaf weui_loading_leaf_3"></div>                        <div class="weui_loading_leaf weui_loading_leaf_4"></div>                        <div class="weui_loading_leaf weui_loading_leaf_5"></div>                        <div class="weui_loading_leaf weui_loading_leaf_6"></div>                        <div class="weui_loading_leaf weui_loading_leaf_7"></div>                        <div class="weui_loading_leaf weui_loading_leaf_8"></div>                        <div class="weui_loading_leaf weui_loading_leaf_9"></div>                        <div class="weui_loading_leaf weui_loading_leaf_10"></div>                        <div class="weui_loading_leaf weui_loading_leaf_11"></div>                    </div>                    <p class="weui_toast_content">数据加载中</p>                </div>            ',o=$("#"+e);if(!o.length){var a=document.createElement("div");$(a).addClass("weui_loading_toast").css("display","none").css("z-index",99999).css("position","absolute").attr("id",e).html(n),$("body").append(a),o=$("#"+e)}i&&o.find(".weui_toast_content").text(i),o.show()},this.hide=function(){var i=$("#"+e);i.length&&(i.hide(),i.remove())},this.setText=function(i){if(i){var n=$("#"+e);n.length&&n.find(".weui_toast_content").text(i)}}}},LOG=new function(){this.trace=function(i,n){e("T",i,n)},this.warn=function(i,n){e("W",i,n)},this.error=function(i,n){e("E",i,n)};var e=function(e,i,n){try{console.log("["+e+"]["+(i||"")+"]"+(n||""))}catch(o){}}},wxAPI=new function(){var e=null,i=null;this.init=function(e,i,n){var o=!1,a=["checkJsApi","onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ","onMenuShareWeibo","hideMenuItems","showMenuItems","hideAllNonBaseMenuItem","showAllNonBaseMenuItem","hideOptionMenu","showOptionMenu","downloadImage","chooseImage","previewImage","uploadImage"],t=function(e){return 1==o?!1:(o=!0,i(e),!0)};$.ajax({type:"POST",url:"http://api.ttxuanpai.com/cgi-bin/get_jsapi_signature",data:JSON.stringify({url:location.href.split("#")[0]}),success:function(i,n){if(console.log("[wx_wrapper]res get_jsapi:"+JSON.stringify(i)),"0"==i.ret){console.log("[wx_wrapper]get jsapi, req wx config");var o=i.data;wx.config({debug:e,appId:o.appId,timestamp:o.timestamp,nonceStr:o.noncestr,signature:o.signature,jsApiList:a}),window.setTimeout(function(){t(!1)&&(console.log("[wx_wrapper]wx config timeout"),QOS_Error("InitWxApiTimeout"))},1e4)}else console.log("[wx_wrapper]request jsapi failed, status:"+n),t(!1),QOS_Error("ReqJsApiFail")},fail:function(){console.log("[wx_wrapper]request jsapi failed, status:"+status),t(!1),QOS_Error("ReqJsApiFail")},dataType:"json"}),wx.ready(function(){console.log("[wx_wrapper]wx ready"),t(!0)}),wx.error(function(e){console.log("[wx_wrapper]wx onerror, res:"+JSON.stringify(e)),t(!1),QOS_Error("WxError")})},this.downloadImage=function(i,n){null==e&&(e=new wxImgDownloader),e.pushTask(i,n)},this.uploadImage=function(e,n){null==i&&(i=new wxImgUploader),i.pushTask(e,n)}},TTXP_Image=new function(){this.loadImage=function(e){var i=new Image;i.onload=function(){e&&e.success&&e.success(this)},i.onerror=function(){e&&e.fail&&e.fail(this)},i.src=e.url},this.clip=function(e,i,n,o,a){var t,s,l,c;o/a>i/n?(s=n,t=Math.floor(n*(o/a))):(t=i,s=Math.floor(i*(a/o))),l=(t-i)/2,c=(s-n)/2,$(e).width(t).height(s).css("left",0-l+"px").css("top",0-c+"px"),e.style.clip="rect("+c+"px "+Math.floor(l+i)+"px "+Math.floor(c+n)+"px "+l+"px)"}};