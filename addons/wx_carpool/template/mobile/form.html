<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <title>{$abc_wx_name_abc}拼车平台</title>

    <link rel="stylesheet" href="../addons/wx_carpool/public/css/weui.css">
    <link rel="stylesheet" href="../addons/wx_carpool/public/css/weui2.css">


    <link rel="stylesheet" type="text/css" href="../addons/wx_carpool/public/css/base.css">
    <link rel="stylesheet" type="text/css" href="../addons/wx_carpool/public/css/common_add.css">
    <link href="../addons/wx_carpool/public/css/loading.css" rel="stylesheet">
    <link href="../addons/wx_carpool/public/css/tongcheng-nav.css" rel="stylesheet">
    <link rel="stylesheet" href="../addons/wx_carpool/public/css/phone-post.css">
    <link rel="stylesheet" href="../addons/wx_carpool/public/css/car-pinche.css">
    <link rel="stylesheet" href="../addons/wx_carpool/public/css/car-persional.css">
    <link rel="stylesheet" href="../addons/wx_carpool/public/css/car-owner.css">
    <link rel="stylesheet" href="../addons/wx_carpool/public/css/detail-second-hand.css">

    <script src="../addons/wx_carpool/public/js/zepto.min.js" type="text/javascript"></script>
    <script src="../addons/wx_carpool/public/js/picker.js" type="text/javascript"></script>

    <style>
        .tc-detail-second-hand-pic img{cursor:pointer;}
        body .layui-m-layer .layui-m-layer-msg{bottom:auto;}

        .weui-picker-overlay, .weui-picker-container{
            z-index: 20;
        }

        .weui-picker-modal .toolbar{
            line-height: 3;
        }

        .weui-picker-modal .toolbar-inner{
            height: 3rem;
        }

        .weui-picker-modal .toolbar-inner{
            line-height: 3rem;
        }

        .weui-picker-modal .picker-button{
            line-height: 32px;
        }

    </style>
</head>
<body>


<form id="p-body" method="post" action="#" style="margin-bottom:2rem;">

    <input type="hidden" name="uid" id="uid" value="{$abc_user_abc['abc_id_abc']}" class="">

    <div class="toplink">
        <div class="con">
            <a class="back" onclick="javascript:window.history.back();" style="position: relative; top: 2px"><img src="../addons/wx_carpool/public/img/ico_top_back.png"></a>
            <h2 class="ind" style="display: inline-block;margin: auto; height: 30px;line-height: 30px;">发布拼车信息</h2>
            <a href="index.php?ID=&amp;F=0&amp;UID=0&amp;nonce_str=" class="home"></a>
        </div>
    </div>

    {if $isOpenRecharge==1}

    <div class="AddTop">
        <div class="AddTopNotice">
            发布：车找人{$abc_price_looking_for_passengers_abc}元，
            人找车{$abc_price_looking_for_driver_abc}元（您的余额：
            <font color="#00F">{$abc_user_abc['abc_balance_abc']}元</font>），
            <a href="{php echo $this->createMobileUrl('recharge')}">
                <font color="#ff5d38">点击充值</font>
            </a>
        </div>

    </div>
    {/if}
    <div class="type-pin1">
        <div class="typeType">
            <div class="type_left">
                拼车类型<i class="required-sign"></i>
            </div>
            <div class="type_center">
                <select name="TypeId" id="TypeIdSelect" class="address">
                    <option value="2">请选择分类</option>
                    <option value="1">车找人</option>
                    <option value="0">人找车</option>
                </select>
            </div>
            <div class="type_right">
                <i></i>
            </div>
        </div>
        <div class="typeType">
            <div class="type_left">
                出&nbsp;&nbsp;发&nbsp;&nbsp;地<i class="required-sign"></i>
            </div>
            <div class="type_center">
                <input type="text" maxlength="16" id="startPoint" name="startPoint" check="need" placeholder="至少2个字最多16个字" class="">
            </div>
        </div>
        <div class="typeType">
            <div class="type_left">
                目&nbsp;&nbsp;的&nbsp;&nbsp;地<i class="required-sign"></i>
            </div>
            <div class="type_center">
                <input type="text" maxlength="16" id="endPoint" name="endPoint" check="need" placeholder="至少2个字最多16个字" class="">
            </div>
        </div>

        <div class="typeType">
            <div class="type_left">
                途&nbsp;&nbsp;&nbsp;径&nbsp;&nbsp;地&nbsp;&nbsp;
            </div>
            <div class="type_center">
                <input type="text" maxlength="16" id="midPoint" name="midPoint" check="need" placeholder="可以不填写哦！" class="">
            </div>
        </div>

        <div class="typeType">
            <div class="type_left">
                出发时间<i class="required-sign"></i>
            </div>
            <div class="type_center">
                <input type="text" readonly="readonly" value="" id="WorkTime" name="WorkTime"  placeholder="请选择出发时间" class="">
            </div>
            </div>
        </div>
        <div class="typeType">
            <div class="type_left">
                补充时间&nbsp;&nbsp;
            </div>
            <div class="type_center">
                <input type="text" maxlength="16" id="DateInfo" name="DateInfo" check="need" placeholder="可以补充具体时间细节哦" class="">
            </div>
        </div>
    </div>
    <div class="type-pin">

        <div class="typeType">
            <div class="type_left">
                手&nbsp;&nbsp;机&nbsp;&nbsp;号<i class="required-sign"></i>
            </div>
            <div class="type_center">

                <input type="tel" id="phone_input" name="LinkPhone" check="need,contact" onkeyup="value = value.replace(/\D/g, '')" placeholder="请填写11位的手机号码" class="">
            </div>
        </div>

        <div class="typeType">
            <div class="type_left">
                联&nbsp;&nbsp;系&nbsp;&nbsp;人&nbsp;&nbsp;
            </div>
            <div class="type_center">
                <input type="text" maxlength="15" id="LinkMan" name="LinkMan" check="need" placeholder="可以不填写" value="" class="">
            </div>
        </div>

        <div class="typeType">
            <div class="type_left">
                人数/空位<i class="required-sign"></i>
            </div>
            <div class="type_center">
                <input type="tel" maxlength="3" id="CarNumberIpt" onkeyup="value = value.replace(/\D/g, '')" name="Number" check="need" placeholder="请填写人数或空位" value="" class="">
            </div>
        </div>


        {if $isStick == 1}
        <div class="typeType">
            <div class="type_left">
                首页置顶&nbsp;&nbsp;
            </div>
            <div class="type_center">
                <select name="TopInfo" id="TopInfo" class="address">

                    <option value="0">不置顶</option>
                </select>
            </div>
        </div>

        {else}

        <div class="typeType" style="display: none">
            <select name="TopInfo" id="TopInfo"  class="address">

                <option value="0">不置顶</option>
            </select>
        </div>

        {/if}




    </div>

    <div class="typedes">
        <div class="typedesLeft">描&nbsp;&nbsp;述</div>
        <div class="typedesRight">
            <textarea maxlength="150" class="typeTxtcar" id="Description" name="Description" placeholder="出发/返程时间、费用、车牌号码/车型等事项"></textarea>
        </div>
    </div>
    <div class="declare" style="padding: 0px; display: none">
        <i><input type="checkbox" id="shenming" checked="checked" class="declareBtn"></i>
        <a id="showshenmin-btn" data href="javascript:;" style="text-decoration:none;">您已阅读并同意《拼车平台声明》</a>
    </div>
    <div class="phone-btn">
        <input id="btn" type="button" class="phone-btnIn" value="点击发布">
    </div>
    <div style="height: 65px;">

    </div>
</form>
{php include $this->template('footer')}


<div id="prompt" style="display: none">
    <div style="display: block; width: 100%;height: 100%; opacity: 0.5; background: #000; left: 0;top: 0;right: 0;left: 0; position: fixed; z-index: 1000"></div>
    <div style="display: block; width: 80%; left: 10%; background: #fff;  border-radius: 5px; top: 30%;  position: fixed;z-index: 3000;">
        <div class="text"  style="text-align: center; padding: 20px; font-size: 20px">
111111111
        </div>
        <div class="btn" style="width: 100%;; text-align: center; line-height: 50px; font-size: 20px; color: #ff0000">
            确认
        </div>
    </div>
</div>

<div id="prompt2" style="display: none">
    <div style="display: block; width: 100%;height: 100%; opacity: 0.5; background: #000; left: 0;top: 0;right: 0;left: 0; position: fixed; z-index: 1000"></div>
    <div style="display: block; width: 80%; left: 10%; background: #fff;  border-radius: 5px; top: 10%;  position: fixed;z-index: 3000;">
        <div class="text"  style="text-align: center; padding: 20px; font-size: 20px">
            发布须知
        </div>
        <textarea style="display:block;margin:auto;border: none;width: 80%;padding: 20px; font-size: 15px" rows="20" readonly>
            {$abc_role_text_abc}
        </textarea>
        <div class="btn" id="close" style="width: 100%;; text-align: center; line-height: 50px; font-size: 20px; color: #ff0000">
            确认
        </div>
    </div>
</div>







<script>


$(function () {

    //规则弹窗
    $("#showshenmin-btn").bind('click',function () {
        $("#prompt2").show();
        $("#prompt2").css('transform','')
        $("#close").click(function () {
            $("#prompt2").hide();
        })
    })

    //监听订单类型变化
    $("#TypeIdSelect").bind('change',function () {
        if ($('#TypeIdSelect option:selected').val()==0){ //人找车

            $("#TopInfo").empty();
            $("#TopInfo").prepend('<option value="0">不置顶</option> <option value="1">置顶一天(收费{$abc_isTop_price3_abc}元)</option> <option value="2">置顶三天(收费{$abc_isTop_price4_abc}元)</option>')

        }else if($('#TypeIdSelect option:selected').val()==1){      //车找人
            $("#TopInfo").empty();
            $("#TopInfo").prepend('<option value="0">不置顶</option> <option value="1">置顶一天(收费{$abc_isTop_price1_abc}元)</option> <option value="2">置顶三天(收费{$abc_isTop_price2_abc}元)</option>')
        }
    })

    //表单输入验证
    $('#btn').bind('click',function () {

        var abc_now_time_abc=new Date();
        var abc_start_time_abc=new Date($('#WorkTime').val().replace(/-/g,"/"));
        var judge=abc_start_time_abc>abc_now_time_abc?1:0;
        var abc_reg_abc=/^1[34578]\d{9}$/
        var abc_phone_abc=$('#phone_input').val()
        if($('#TypeIdSelect option:selected').val()==2){
            alert("选择拼车分类")
        }else if ($('#startPoint').val()==""){
            alert("请填写出发地")
        }else if ($('#endPoint').val()==""){
            alert("请填写目的地")
        } else if ($('#WorkTime').val()==""||judge==0){
            alert("请选择正确时间")
        } else if (abc_phone_abc==""||!abc_reg_abc.test(abc_phone_abc)){
            alert("请填写正确手机号时间")
        }else if($('#CarNumberIpt').val()==""){
            alert("请填写空位数/乘车人数")
        }else if(!$('#shenming').is(':checked')){
            alert("请阅读并同意声明")
        } else{
            //创建提交JSON数组
            var data={
                "abc_uid_abc":$('#uid').val(),//用户ID
                "abc_order_type_abc":$('#TypeIdSelect option:selected').val(),//订单类型
                "abc_place_of_departure_abc":$('#startPoint').val(),//出发地
                "abc_destination_abc":$('#endPoint').val(),//目的地
                "abc_pathway_abc":$('#midPoint').val(),//途径地
                "abc_departure_time_abc":$('#WorkTime').val(),//出发时间
                "abc_replenishment_time_abc":$('#DateInfo').val(),//补充时间
                "abc_phone_abc":$('#phone_input').val(),//手机号
                "abc_name_abc":$('#LinkMan').val(),//联系人
                "abc_number_abc":$('#CarNumberIpt').val(),//空位或乘客数量
                "abc_isTop_abc":$('#TopInfo option:selected').val(),//是否置顶
                "abc_describe_abc":$('#Description').val(),//描述
            }


            $.ajax({
               type:"post",
            /*    url:"./index.php?i=7&c=entry&do=addOrder&m=wx_carpool&data="+data,*/
                url:"{php echo $this->createMobileUrl('addOrder')}",
                data:data,
                dataType:"json",
                success:function (data) {
                    if (data.success){
        /*                $("#prompt .text").text("提交成功");
                        $("#prompt").show();
                        $("#prompt").css('transform','')
                        $("#prompt .btn").unbind().click(function(){
                            window.location.href="{php echo $this->createMobileUrl('Index')}"
                        })*/

                        alert("提交成功");
                        window.location.href="{php echo $this->createMobileUrl('Index')}"


                    }else{

         /*               $("#prompt .text").text(data.data);
                        $("#prompt").show();
                        $("#prompt").css('transform','')
                        $("#prompt .text").unbind().click(function(){
                            $("#prompt").hide()
                            $("#prompt").css('transform','')
                        })*/

                        alert(data.data);

                    }
                },
                error:function (jqXHR) {
                    alert("错误："+jqXHR.status)
                }
            });

        }
    })

})
</script>
<script>
    $(function () {
        $("#WorkTime").datetimePicker({title:"选择日期时间"});


    })
</script>
</body>
</html>