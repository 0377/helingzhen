<!doctype html>

<html>

<head>

<meta charset="utf-8">

<meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">

<meta name="apple-mobile-web-app-capable" content="yes">

<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

<meta name="format-detection" content="telephone=no">

<meta name="msapplication-tap-highlight" content="no">


<script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>

<script src="../addons/zm_jfb/js/jquery.1.7.1.min.js"></script>

<link rel="stylesheet" href="../addons/zm_jfb/css/uindex.css">  

<title>{$setting['title']}</title>


</head>

<body>

<section class="main">
	<div class="top">推荐好友领取会员卡 有奖励</div>
	<!-- <div class="topdiv" >
	
		
		<div class="topimg">
			<div class="topimgdiv">
				
				<div class="topmsg">
					<img src="{php echo $avatar}" />
					<span>{php echo $nickname}</span>
				</div>
				<div class="clear"></div>
				<div class="topdj">会员卡</div>
				
			
			</div>
			<div class="topbotoom">门店</div>
		</div>
		
	</div>
	-->
	<div class="hd">
		<div class="box">
			<!-- 
			<div>
				<img src="{php echo $avatar}" alt="">
			</div>
			<p>
				<span>{php echo $nickname}</span><br><span>会员卡</span>
			</p>
			<i><span>门店</span></i>
			 -->
			 {if !empty($topimg)}
			 <img src="{php echo tomedia($topimg)}" />
			 {else}
			 <img src="../addons/zm_jfb/img/user.png" />
			 {/if}
		</div>
	</div>
	
	<div class="basiccon">
	
		<div class="basicdiv">
			<ul>
				<li><span><i class="iy"></i>余额</span><br/><span class="s2">{if $setting['ifyue']==0}{php echo $yue_num}{else}***{/if}</span></li>
				<li><span><i class="ij"></i>积分</span><br/><span class="s2">{if $setting['ifjifen']==0}{php echo $jifen_num}{else}***{/if}</span></li>
				<li><span><i class="id"></i>等级</span><br/><span class="s2">{if $setting['ifdengji']==0}{php echo $group_str}{else}***{/if}</span></li>
			</ul>
			<div class="goyue"><!-- <a href="javascript:void(0)" onclick="return clickyue()">充余额</a> --><a href="{php echo  $this->createMobileUrl('chongzhi');}">充余额</a></div>
		</div>
		
	</div>
	
	
		<!-- <div class="morediv">
		<a class="tjhref card">添至微信卡包<span class="iconfont">&#xe613;</span><span>(已领取)</span></a>
		</div>
	
		<div class="cardimg" style="display:none">
			<p>(扫一扫，添加至微信卡包)</p>
			<img class="card_img" src="../addons/zm_jfb/befor.png" style="width:50px;height:50px;"/>
			
		</div>
	 	-->
	
		<div class="morediv">
		<a class="tjhref" href="{php echo  $this->createMobileUrl('czjl',array('uid'=>$uid));}">余额充值记录<span class="iconfont">&#xe613;</span></a>
		</div>
	
	
	
		<div class="morediv">
		<a class="tjhref" href="{php echo $this->createMobileUrl('mendian');}">附近门店<span class="iconfont">&#xe613;</span></a>
		</div>
	
	<div class="kongpadd"></div>
	
		<div class="morediv">
		<a class="tjhref" {if !empty($setting['jifenshop'])}href="{php echo $setting['jifenshop']}"{/if}">{if !empty($setting['jifen_name'])}{$setting['jifen_name']}{else}积分商城{/if}<span class="iconfont">&#xe613;</span></a>
		</div>
	
	
	
		<div class="morediv">
		<a class="tjhref" {if !empty($setting['gongzhonghao1'])}href="{php echo $setting['gongzhonghao1']}"{/if}">{if !empty($setting['gzh_name'])}{$setting['gzh_name']}{else}查看公众号{/if}<span class="iconfont">&#xe613;</span></a>
		</div>
	
	
	
		<div class="morediv">
		<a class="tjhref" {if !empty($setting['mendian1'])}href="{php echo $setting['mendian1']}"{/if}">{if !empty($setting['md_name'])}{$setting['md_name']}{else}使用门店{/if}<span class="iconfont">&#xe613;</span></a>
		</div>
	
	<div class="kongpadd"></div>
	
	<div class="receive_card">
<div class="receive_card_b">
	<div class="card_img">
		{if !empty($setting['headerimg'])}<img src="{php echo tomedia($setting['headerimg'])}"/>{/if}
	</div>
	<dl>
		
		<dd>
			<span>姓名：</span><input type="text" name="txtname" id="txtname" value="{php echo $realname}" maxlength="5"/>
		</dd>
		<dd>
			<span>手机号：</span><input type="tel" name="txtphone" id="txtphone" value="{php echo $telephone}" maxlength="11"/>
		</dd>
		
	</dl>
	<div class="receive_card_a">
		<div>
		<a class="t_receive" href="javascript:void(0);" onclick="return savevip()">领取会员卡</a>
		<button class="f_receive" href="javascript:void(0);" >领取会员卡</button>
		{if $setting['ifgroup'] == 1}
		<a class="t_shiti" href="javascript:void(0);" onclick="savecard()">绑定实体卡</a>
		<button class="f_shiti" href="javascript:void(0);" >绑定实体卡</button>
		{/if}
		</div>
		{if $setting['gethy'] == 0}
		<p>{if $setting['xhjifen']!=0 && $setting['xhyue']!=0}<span>(领取需消耗</span><span>{$setting['xhyue']}</span><span>余额，</span><span>{$setting['xhjifen']}</span><span>积分)</span>
		{elseif $setting['xhjifen']!=0 }<span>(领取需消耗</span><span>{$setting['xhjifen']}</span><span>积分)</span>{elseif $setting['xhyue']!=0}<span>(领取需消耗</span><span>{$setting['xhyue']}</span><span>余额)</span>
		{else}<span>&nbsp;</span>{/if}</p>
		{else}
		<p>{if $setting['xhjifen']!=0 && $setting['xhyue']!=0}<span>(领取获得</span><span>{$setting['xhyue']}</span><span>余额，</span><span>{$setting['xhjifen']}</span><span>积分)</span>
		{elseif $setting['xhjifen']!=0 }<span>(领取获得</span><span>{$setting['xhjifen']}</span><span>积分)</span>{elseif $setting['xhyue']!=0}<span>(领取获得</span><span>{$setting['xhyue']}</span><span>余额)</span>
		{else}<span>&nbsp;</span>{/if}</p>
		{/if}
		
		
	</div>
</div>
	</div>
	
	<!-- 
	<div class="receive_cz">
		<div class="receive_cz_b">
			
				<dl>
					<dd>
						<ul>
							{loop $_list $row}
							<li><p class="item" data-v="{php echo $row['czmoney']}" data-z="{php echo $row['zsmoney']}">{php echo $row['czmoney']}元</p><span>(充{php echo $row['czmoney']}送{php echo $row['zsmoney']})</span></li>
							{/loop}
						</ul>
					</dd>
				</dl>
				
				<div class="receive_cz_a">
				
					<input type="hidden" name="czmoney" id="czmoney" value="50" />
					<input type="hidden" name="zsmoney" id="zsmoney" value="20" />
					<!--<a class="mui-usable js-wechat-pay" href="javascript:void(0);" onclick="post_pay()">充        值</a>
					<input type="submit" class="btn mui-usable js-wechat-pay" name="submit" id="submit" value="充       值" /> 
					<div class="mui-disabled js-wechat-pay" href="javascript:void(0);">充        值</div>
					<input type="hidden" name="token" value="{$_W['token']}" />
					
				</div>
			
			<div class="cztext">
				备注:<br/>
				{php echo $cztext}
			</div>
		</div>
	</div>
	 -->

</section>




<footer class="footerdiv">
	<div class="footdiv">
		<img src="../attachment/{php echo $setting['footerimg']}" style="width:50px;height:50px;padding-top:5px;" />
		<p>{$setting['footerCopyright']}</p>
	</div>
</footer>

<script>
$(".card").click(function(){
	$(".card_img").css("width","50");
	$(".card_img").css("height","50");
	
	if($(".cardimg").is(":hidden")){
		$(".card_img").attr('src','../addons/zm_jfb/img/loading.gif');
		
		$.ajax({
	        url:"{php echo $this->createMobileUrl('uindex')}",
	        type:'POST',
	        dataType:'json',
	        async:false,
	        data:{
	          opp:"getcard"
	        },
	        success:function(msg){
	        	
	        	$(".card_img").attr('src','');
				$(".card_img").attr('src',msg.url);
				$(".card_img").css("width","150");
				$(".card_img").css("height","150");
				if(msg.lq == 1){
					$('.card>span:nth-child(2)').show();
				}
	        }
	     });
		
		$(".cardimg").show();
		$('>span:nth-child(1)',this).html("&#xe621;");
		
	}else{
		$(".cardimg").hide();
		$('>span:nth-child(1)',this).html("&#xe613;");
	}
})
$(function(){
	$('.card>span:nth-child(2)',this).hide();
	$('.receive_card').css('display','none');
	$('.receive_cz').css('display','none');
	$('.mui-disabled').css('display','none');
	
	$.ajax({
        url:"{php echo $this->createMobileUrl('uindex')}",
        type:'POST',
        dataType:'json',
        async:false,
        data:{
          opp:"showhy"
        },
        success:function(msg){
        	if(msg.hy == true){
   			 $('.receive_card').css('display','none');
    		}else{
    			$('.receive_card').css('display','block');	
    		}
        	
        	if(msg.lq == 1){
        		$('.card>span:nth-child(2)').show();
        	}else{
        		$('.card>span:nth-child(2)').hide();
        	}
        }
    });	
	
	$(".receive_cz_b li:nth-child(1) p").removeClass("item");
	$(".receive_cz_b li:nth-child(1) p").addClass("change_item");
	
	$("#czmoney").val($(".receive_cz_b li:nth-child(1) p").attr("data-v"));
	$("#zsmoney").val($(".receive_cz_b li:nth-child(1) p").attr("data-z"));
});

$(".receive_cz_b").on("click","li p",function(){
	$(".receive_cz_b li p").removeClass("change_item");
	$(".receive_cz_b li p").addClass("item");
	
	$("#czmoney").val($(this).attr("data-v"));
	$("#zsmoney").val($(this).attr("data-z"));
	$(this).addClass("change_item");
});

function clickyue(){
	$('.receive_cz').show();
	$('.receive_cz_b').show();
	
}

function post_pay(){
	$('.mui-disabled').show();
	$('.mui-usable').hide();
	
	return true;
	/*
	$.ajax({
        url:"{php echo $this->createMobileUrl('uindex')}",
        type:'POST',
        dataType:'json',
        async:false,
        data:{
          opp:"pay",
          czmoney:$("#czmoney").val(),
          czmoney:$("#czmoney").val()
        },
        success:function(msg){
        	//alert(msg);
        	//alert(msg.appId);
        	//alert(msg.timeStamp);
        	//alert(msg.nonceStr);
        	//alert(msg.paySign);
        	callpay(msg,$("#czmoney").val(),$("#zsmoney").val());
        	//onBridgeReady(msg,$("#czmoney").val(),$("#zsmoney").val());
        }
     });
	*/
	
	
}

function onBridgeReady(msg,price,zsprice){
	WeixinJSBridge.invoke(
		       'getBrandWCPayRequest', {
		           "appId":msg.appId,     //公众号名称，由商户传入     
		           "timeStamp":msg.timeStamp,         //时间戳，自1970年以来的秒数     
		           "nonceStr":msg.nonceStr, //随机串     
		           "package":msg.package,     
		           "signType":msg.signType,         //微信签名方式：     
		           "paySign":msg.paySign //微信签名 
		       },
		       function(res){  
		    	   
		        	
		           if(res.err_msg == "get_brand_wcpay_request:ok" ) {
		        	   starus = 1;
		        	   
		        	   $('.receive_cz_b').hide();
		        	   $('.receive_cz').hide();
		        	   
		        	  
		        	   var url = "{php echo $this->createMobileUrl('uindex')}";
		        		$.get(url, {'opp' :'insert','price':price,'zsprice':zsprice,'ret':status}, function(data){
							
		        		});
		        		alert("充值成功！");
		        	    
		           }else if(res.err_msg == "get_brand_wcpay_request:fail"){
		        	   status = 2;
		        	   
		        	   
		        	   //var url = "{php echo $this->createMobileUrl('uindex')}";
		        		//$.get(url, {'opp' :'insert','price':price,'ret':status}, function(data){
							//alert("云会员充值");
		        		//});
		        		
		        		alert("充值失败!");
		           }

			       	$('.mui-disabled').hide();
			       	$('.mui-usable').show();
		           window.location.reload();
		       }
		   );
}
function callpay(msg,$czmoney,$zsmoney){
	if (typeof WeixinJSBridge == "undefined"){
	   if( document.addEventListener ){
	       document.addEventListener('WeixinJSBridgeReady', onBridgeReady, false);
	   }else if (document.attachEvent){
	       document.attachEvent('WeixinJSBridgeReady', onBridgeReady); 
	       document.attachEvent('onWeixinJSBridgeReady', onBridgeReady);
	   }
	}else{
	   onBridgeReady(msg,$czmoney,$zsmoney);
	} 
}
 

$(function(){
	/*$('.receive_card').css('display','none');
	var url = "{php echo $this->createMobileUrl('uindex')}";
	$.get(url, {'opp' :'showhy'}, function(data){

		alert(data);
		if(data=='true'){
			alert(data);
			 $('.receive_card').css('display','none');
		}else{

			$('.receive_card').css('display','block');
		}
		
	});
	
	$.ajax({
		url:"{php echo $this->createMobileUrl('uindex')}",
		dataType:'json',
		type:'POST', 
		async:false,
		data:{'opp' :'showhy'},
		
		success:function(data){

			alert(data.stauts);
			if(data.stauts == 'a'){
				alert(data.stauts);
				$('.receive_card').css('display','none');
			}else{

				$('.receive_card').css('display','block');
			}
		}
});*/
});
$('.receive_card').click(function() {
	$('.receive_card').hide();
	/* 
	e.stopPropagation()
	    if(e.originalEvent.touches){
	        
	    }else{
	    	$('.receive_card').hide();
	    	return false;
	     }
    */
});
$('.receive_card_b').click(function() {
	return false;
});
$('.receive_cz').click(function() {
	
	$('.receive_cz').hide();
});
$('.receive_cz_b').click(function() {
	 return false;
});



function savevip(){
	if($("#txtname").val() == ""){
		alert("请填写姓名");
		$("#txtname").focus();
		return false;
	}
	if($("#txtphone").val() == ""){
		alert("请填写电话");
		$("#txtphone").focus();
		return false;
	}
	
	
	$('.f_receive').hide();
	$('.t_receive').show();
	
	$.ajax({
		
        url:"{php echo $this->createMobileUrl('uindex')}",
        type:'POST',
        dataType:'json',
        async:false,
        data:{
          opp:"vip",
          name:$("#txtname").val(),
          phone:$("#txtphone").val()
        },
        success:function(msg){
        	
        	if(msg.appId!=undefined){
        		receivepay(msg);
        		//onBridgeReady1(msg);
        		
        		
        	}else if(msg.ret == true){
        		alert("领取成功！");
    			$('.receive_card').css('display','none');
        	}
        }
     });
	
	return true;

	/*
	var url = "{php echo $this->createMobileUrl('uindex')}";
	$.get(url, {'opp' :'vip','name':$("#txtname").val(),'phone':$("#txtphone").val()}, function(msg){

		
		if(msg == "credit1"){
			alert("领取失败，积分不足！");
		}else if(msg == "credit2"){
			alert("领取失败，余额不足！");
		}else if(msg){
			alert("领取成功！");
			$('.receive_card').css('display','none');
	        
		}
		
	});
	*/
}

function savecard(){
	if($("#txtname").val() == ""){
		alert("请填写姓名");
		$("#txtname").focus();
		return false;
	}
	if($("#txtphone").val() == ""){
		alert("请填写电话");
		$("#txtphone").focus();
		return false;
	}
	
	
	$('.f_shiti').hide();
	$('.t_shiti').show();
	
	
$.ajax({
		
        url:"{php echo $this->createMobileUrl('uindex')}",
        type:'POST',
        dataType:'json',
        async:false,
        data:{
          opp:"card",
          name:$("#txtname").val(),
          phone:$("#txtphone").val()
        },
        success:function(msg){
        	
        	if(msg.ret == true){
        		alert("领取成功！");
    			$('.receive_card').css('display','none');
        	}
        }
     });
	
	$('.t_shiti').hide();
	$('.f_shiti').show();
	return true;
}
function onBridgeReady1(msg){
	WeixinJSBridge.invoke(
		       'getBrandWCPayRequest', {
		           "appId":msg.appId,     //公众号名称，由商户传入     
		           "timeStamp":msg.timeStamp,         //时间戳，自1970年以来的秒数     
		           "nonceStr":msg.nonceStr, //随机串     
		           "package":msg.package,     
		           "signType":msg.signType,         //微信签名方式：     
		           "paySign":msg.paySign //微信签名 
		       },
		       function(res){  
		    	   
		           if(res.err_msg == "get_brand_wcpay_request:ok" ) {
		        	   
		        	   $.ajax({
		        			
		        	        url:"{php echo $this->createMobileUrl('uindex')}",
		        	        type:'POST',
		        	        dataType:'json',
		        	        async:false,
		        	        data:{
		        	          opp:"vippay",
		        	          name:$("#txtname").val(),
		        	          phone:$("#txtphone").val()
		        	        },
		        	        success:function(msg){
		        	        	$('.receive_card').css('display','none');
				        		alert("会员卡领取成功！");
		        	        }
		        	   });
		        	   
		        	    
		           }else if(res.err_msg == "get_brand_wcpay_request:fail"){
		        	   
		        	   
		        	   alert("会员卡领取失败！");
		           }
		           $(".f_receive").hide();
			       	$(".t_receive").show();
			       	   
			       	window.location.reload();
		       }
		   );
}
function receivepay(msg){
	if (typeof WeixinJSBridge == "undefined"){
	   if( document.addEventListener ){
	       document.addEventListener('WeixinJSBridgeReady', onBridgeReady1, false);
	   }else if (document.attachEvent){
	       document.attachEvent('WeixinJSBridgeReady', onBridgeReady1); 
	       document.attachEvent('onWeixinJSBridgeReady', onBridgeReady1);
	   }
	}else{
	   onBridgeReady1(msg);
	} 
}


    
 
</script>
</body>

</html>